#!/bin/bash

PROG="@PROG@"
VERSION="@VERSION@"
BUGREPORT="@BUGREPORT@"
URL="@URL@"

prefix="@prefix@"
exec_prefix="@exec_prefix@"
CONFDIR="@CONFDIR@"
EXECDIR="@EXECDIR@"

if [ -f "$CONFDIR/clicraft.conf" ]; then
	. "$CONFDIR/clicraft.conf"
fi

. "$EXECDIR/defaults.sh"
. "$EXECDIR/functions.sh"
if [ ! -f "$EXECDIR/$MULTIPLEXER.sh" ] || \
   ! which "$MULTIPLEXER" &>/dev/null; then
	err "Invalid multiplexer: $MULTIPLEXER"
	exit 1
else
	. "$EXECDIR/$MULTIPLEXER.sh"
fi

# bail if we're root
if [ "$(id -u)" = "0" ]; then
	err "You cannot run this program as root"
	exit 1
fi

# attempt to create SERVER_DIR
# (failure caught in cd check)
mkdir -p "$SERVER_DIR" 2>/dev/null

# bail if we can't cd
cd "$SERVER_DIR" 2>/dev/null
retval="$?"
if [ "$retval" != 0 ]; then
	err "Could not change to directory $SERVER_DIR"
	exit "$retval"
fi

case "$1" in
  "--version")
	action version "$@"
  ;;
  "--help"|"-h")
	shift
	action help "$@"
  ;;
  "")
	action help
  ;;
  *)
	action "$@"
  ;;
esac

